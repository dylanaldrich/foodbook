{"version":3,"file":"focus-trap.umd.js","sources":["../index.js"],"sourcesContent":["import { tabbable, isFocusable } from 'tabbable';\n\nvar activeFocusDelay;\n\nvar activeFocusTraps = (function () {\n  var trapQueue = [];\n  return {\n    activateTrap: function (trap) {\n      if (trapQueue.length > 0) {\n        var activeTrap = trapQueue[trapQueue.length - 1];\n        if (activeTrap !== trap) {\n          activeTrap.pause();\n        }\n      }\n\n      var trapIndex = trapQueue.indexOf(trap);\n      if (trapIndex === -1) {\n        trapQueue.push(trap);\n      } else {\n        // move this existing trap to the front of the queue\n        trapQueue.splice(trapIndex, 1);\n        trapQueue.push(trap);\n      }\n    },\n\n    deactivateTrap: function (trap) {\n      var trapIndex = trapQueue.indexOf(trap);\n      if (trapIndex !== -1) {\n        trapQueue.splice(trapIndex, 1);\n      }\n\n      if (trapQueue.length > 0) {\n        trapQueue[trapQueue.length - 1].unpause();\n      }\n    },\n  };\n})();\n\nfunction createFocusTrap(element, userOptions) {\n  var doc = document;\n  var container =\n    typeof element === 'string' ? doc.querySelector(element) : element;\n\n  var config = {\n    returnFocusOnDeactivate: true,\n    escapeDeactivates: true,\n    delayInitialFocus: true,\n    ...userOptions,\n  };\n\n  var state = {\n    firstTabbableNode: null,\n    lastTabbableNode: null,\n    nodeFocusedBeforeActivation: null,\n    mostRecentlyFocusedNode: null,\n    active: false,\n    paused: false,\n  };\n\n  var trap = {\n    activate: activate,\n    deactivate: deactivate,\n    pause: pause,\n    unpause: unpause,\n  };\n\n  return trap;\n\n  function activate(activateOptions) {\n    if (state.active) return;\n\n    updateTabbableNodes();\n\n    state.active = true;\n    state.paused = false;\n    state.nodeFocusedBeforeActivation = doc.activeElement;\n\n    var onActivate =\n      activateOptions && activateOptions.onActivate\n        ? activateOptions.onActivate\n        : config.onActivate;\n    if (onActivate) {\n      onActivate();\n    }\n\n    addListeners();\n    return trap;\n  }\n\n  function deactivate(deactivateOptions) {\n    if (!state.active) return;\n\n    clearTimeout(activeFocusDelay);\n\n    removeListeners();\n    state.active = false;\n    state.paused = false;\n\n    activeFocusTraps.deactivateTrap(trap);\n\n    var onDeactivate =\n      deactivateOptions && deactivateOptions.onDeactivate !== undefined\n        ? deactivateOptions.onDeactivate\n        : config.onDeactivate;\n    if (onDeactivate) {\n      onDeactivate();\n    }\n\n    var returnFocus =\n      deactivateOptions && deactivateOptions.returnFocus !== undefined\n        ? deactivateOptions.returnFocus\n        : config.returnFocusOnDeactivate;\n    if (returnFocus) {\n      delay(function () {\n        tryFocus(getReturnFocusNode(state.nodeFocusedBeforeActivation));\n      });\n    }\n\n    return trap;\n  }\n\n  function pause() {\n    if (state.paused || !state.active) return;\n    state.paused = true;\n    removeListeners();\n  }\n\n  function unpause() {\n    if (!state.paused || !state.active) return;\n    state.paused = false;\n    updateTabbableNodes();\n    addListeners();\n  }\n\n  function addListeners() {\n    if (!state.active) return;\n\n    // There can be only one listening focus trap at a time\n    activeFocusTraps.activateTrap(trap);\n\n    // Delay ensures that the focused element doesn't capture the event\n    // that caused the focus trap activation.\n    activeFocusDelay = config.delayInitialFocus\n      ? delay(function () {\n          tryFocus(getInitialFocusNode());\n        })\n      : tryFocus(getInitialFocusNode());\n\n    doc.addEventListener('focusin', checkFocusIn, true);\n    doc.addEventListener('mousedown', checkPointerDown, {\n      capture: true,\n      passive: false,\n    });\n    doc.addEventListener('touchstart', checkPointerDown, {\n      capture: true,\n      passive: false,\n    });\n    doc.addEventListener('click', checkClick, {\n      capture: true,\n      passive: false,\n    });\n    doc.addEventListener('keydown', checkKey, {\n      capture: true,\n      passive: false,\n    });\n\n    return trap;\n  }\n\n  function removeListeners() {\n    if (!state.active) return;\n\n    doc.removeEventListener('focusin', checkFocusIn, true);\n    doc.removeEventListener('mousedown', checkPointerDown, true);\n    doc.removeEventListener('touchstart', checkPointerDown, true);\n    doc.removeEventListener('click', checkClick, true);\n    doc.removeEventListener('keydown', checkKey, true);\n\n    return trap;\n  }\n\n  function getNodeForOption(optionName) {\n    var optionValue = config[optionName];\n    var node = optionValue;\n    if (!optionValue) {\n      return null;\n    }\n    if (typeof optionValue === 'string') {\n      node = doc.querySelector(optionValue);\n      if (!node) {\n        throw new Error('`' + optionName + '` refers to no known node');\n      }\n    }\n    if (typeof optionValue === 'function') {\n      node = optionValue();\n      if (!node) {\n        throw new Error('`' + optionName + '` did not return a node');\n      }\n    }\n    return node;\n  }\n\n  function getInitialFocusNode() {\n    var node;\n    if (getNodeForOption('initialFocus') !== null) {\n      node = getNodeForOption('initialFocus');\n    } else if (container.contains(doc.activeElement)) {\n      node = doc.activeElement;\n    } else {\n      node = state.firstTabbableNode || getNodeForOption('fallbackFocus');\n    }\n\n    if (!node) {\n      throw new Error(\n        'Your focus-trap needs to have at least one focusable element'\n      );\n    }\n\n    return node;\n  }\n\n  function getReturnFocusNode(previousActiveElement) {\n    var node = getNodeForOption('setReturnFocus');\n    return node ? node : previousActiveElement;\n  }\n\n  // This needs to be done on mousedown and touchstart instead of click\n  // so that it precedes the focus event.\n  function checkPointerDown(e) {\n    if (container.contains(e.target)) {\n      // allow the click since it ocurred inside the trap\n      return;\n    }\n\n    if (config.clickOutsideDeactivates) {\n      // immediately deactivate the trap\n      deactivate({\n        // if, on deactivation, we should return focus to the node originally-focused\n        //  when the trap was activated (or the configured `setReturnFocus` node),\n        //  then assume it's also OK to return focus to the outside node that was\n        //  just clicked, causing deactivation, as long as that node is focusable;\n        //  if it isn't focusable, then return focus to the original node focused\n        //  on activation (or the configured `setReturnFocus` node)\n        // NOTE: by setting `returnFocus: false`, deactivate() will do nothing,\n        //  which will result in the outside click setting focus to the node\n        //  that was clicked, whether it's focusable or not; by setting\n        //  `returnFocus: true`, we'll attempt to re-focus the node originally-focused\n        //  on activation (or the configured `setReturnFocus` node)\n        returnFocus: config.returnFocusOnDeactivate && !isFocusable(e.target),\n      });\n      return;\n    }\n\n    // This is needed for mobile devices.\n    // (If we'll only let `click` events through,\n    // then on mobile they will be blocked anyways if `touchstart` is blocked.)\n    if (\n      config.allowOutsideClick &&\n      (typeof config.allowOutsideClick === 'boolean'\n        ? config.allowOutsideClick\n        : config.allowOutsideClick(e))\n    ) {\n      // allow the click outside the trap to take place\n      return;\n    }\n\n    // otherwise, prevent the click\n    e.preventDefault();\n  }\n\n  // In case focus escapes the trap for some strange reason, pull it back in.\n  function checkFocusIn(e) {\n    // In Firefox when you Tab out of an iframe the Document is briefly focused.\n    if (container.contains(e.target) || e.target instanceof Document) {\n      return;\n    }\n    e.stopImmediatePropagation();\n    tryFocus(state.mostRecentlyFocusedNode || getInitialFocusNode());\n  }\n\n  function checkKey(e) {\n    if (config.escapeDeactivates !== false && isEscapeEvent(e)) {\n      e.preventDefault();\n      deactivate();\n      return;\n    }\n    if (isTabEvent(e)) {\n      checkTab(e);\n      return;\n    }\n  }\n\n  // Hijack Tab events on the first and last focusable nodes of the trap,\n  // in order to prevent focus from escaping. If it escapes for even a\n  // moment it can end up scrolling the page and causing confusion so we\n  // kind of need to capture the action at the keydown phase.\n  function checkTab(e) {\n    updateTabbableNodes();\n    if (e.shiftKey && e.target === state.firstTabbableNode) {\n      e.preventDefault();\n      tryFocus(state.lastTabbableNode);\n      return;\n    }\n    if (!e.shiftKey && e.target === state.lastTabbableNode) {\n      e.preventDefault();\n      tryFocus(state.firstTabbableNode);\n      return;\n    }\n  }\n\n  function checkClick(e) {\n    if (config.clickOutsideDeactivates) return;\n    if (container.contains(e.target)) return;\n    if (\n      config.allowOutsideClick &&\n      (typeof config.allowOutsideClick === 'boolean'\n        ? config.allowOutsideClick\n        : config.allowOutsideClick(e))\n    ) {\n      return;\n    }\n    e.preventDefault();\n    e.stopImmediatePropagation();\n  }\n\n  function updateTabbableNodes() {\n    var tabbableNodes = tabbable(container);\n    state.firstTabbableNode = tabbableNodes[0] || getInitialFocusNode();\n    state.lastTabbableNode =\n      tabbableNodes[tabbableNodes.length - 1] || getInitialFocusNode();\n  }\n\n  function tryFocus(node) {\n    if (node === doc.activeElement) return;\n    if (!node || !node.focus) {\n      tryFocus(getInitialFocusNode());\n      return;\n    }\n    node.focus({ preventScroll: !!config.preventScroll });\n    state.mostRecentlyFocusedNode = node;\n    if (isSelectableInput(node)) {\n      node.select();\n    }\n  }\n}\n\nfunction isSelectableInput(node) {\n  return (\n    node.tagName &&\n    node.tagName.toLowerCase() === 'input' &&\n    typeof node.select === 'function'\n  );\n}\n\nfunction isEscapeEvent(e) {\n  return e.key === 'Escape' || e.key === 'Esc' || e.keyCode === 27;\n}\n\nfunction isTabEvent(e) {\n  return e.key === 'Tab' || e.keyCode === 9;\n}\n\nfunction delay(fn) {\n  return setTimeout(fn, 0);\n}\n\nexport { createFocusTrap };\n"],"names":["activeFocusDelay","activeFocusTraps","trapQueue","activateTrap","trap","length","activeTrap","pause","trapIndex","indexOf","push","splice","deactivateTrap","unpause","createFocusTrap","element","userOptions","doc","document","container","querySelector","config","returnFocusOnDeactivate","escapeDeactivates","delayInitialFocus","state","firstTabbableNode","lastTabbableNode","nodeFocusedBeforeActivation","mostRecentlyFocusedNode","active","paused","activate","deactivate","activateOptions","updateTabbableNodes","activeElement","onActivate","addListeners","deactivateOptions","clearTimeout","removeListeners","onDeactivate","undefined","returnFocus","delay","tryFocus","getReturnFocusNode","getInitialFocusNode","addEventListener","checkFocusIn","checkPointerDown","capture","passive","checkClick","checkKey","removeEventListener","getNodeForOption","optionName","optionValue","node","Error","contains","previousActiveElement","e","target","clickOutsideDeactivates","isFocusable","allowOutsideClick","preventDefault","Document","stopImmediatePropagation","isEscapeEvent","isTabEvent","checkTab","shiftKey","tabbableNodes","tabbable","focus","preventScroll","isSelectableInput","select","tagName","toLowerCase","key","keyCode","fn","setTimeout"],"mappings":"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"}